---
title: 最近的一些记录
url: 126.html
id: 126
categories:
  - Bob
date: 2017-02-06 10:39:18
tags:
---

1\. 最近把61850那些程序移植到linux下了，暂时把涉及到windows专用sdk等等都改成了linux下，有一些没有对应模式的（如waitformultipleobject）就换了一些使用方式。 由于pthread替换win thread的关系，又重温了以便the linux programming interface这本书，发现每次都有收获。这回把windows的event和linux的condition对比明白了，弄个类似event的类便于移植好多event有关代码。 内存映射文件部分没问题，但linux下我想也用不到了，win下主要是服务和子进程间通信用了，linux下我看supervisord那个程序很号，没有具体测试，实在不行就先各个进程单独运行，再好点自己弄个daemon啥的监控一下。怎么的也比win下简单，我考虑。 另外就是原来在windows下用的那套基于libevent的hiredis异步事件机制没有用，我看把redis的subscribe命令在单独线程里转之后，同步一直读这个方式也可行，先设置读超时，然后while里面不断调用处理就可以。暂时未采用任何异步模式hiredis操作，慢慢看看在用ae什么的。 现在还有一个就是直接操作hiredis的context对象，没有pool什么的，每次失败都重连一下，比较粗糙。下一步考虑怎么好弄一个连接池管理一下。 2. 另外一个，一直考虑通信机移植后的一些基础结构和基础服务类问题。个人倾向于采用多进程+redis缓存模式处理，但这样基本算是重来，不算移植了，工作量估计比较大。第一步考虑是否硬移植，原来win下程序结构不变，还是主程序+n个驱动程序，采用dlopen模式装载各个部分，然后还是数据路由模式。这样也要考虑串口+网络的底层驱动库问题。 原来一段时间一直在简单的包装linux serial和socket作为两个类使用，还是使用现成的类库（asio）。各有利弊，考虑过好几次，没有定下来。 今天好好分析了一下使用asio的方式，发现除了依赖一些boost库外，看上去很好，串口和网络库都统一了。由于原win下好多用法都是同步方式使用串口网口，分析一下asio的异步模式提供同步接口的情况，发现也可以。 具体看到了一些参考: a.[国内blog上的一个例子](http://mayacong.blog.51cto.com/3724695/1156818) b.[MIRA库用asio的实现](http://www.mira-project.org/MIRA-doc/SyncTimedRead_8h_source.html) c.[stackoverflow上的一个讨论，尤其是C++11部分](http://stackoverflow.com/questions/10858719/cancel-async-read-due-to-timeout) 基本上这些满足要求了。而且网络情况也可同样使用，很好。 3\. 上面考虑asio串口时候想到linux下串口调试，google一下虚拟串口发现linux这方面很好，比win的vpsd那些都方便，找了一下，参考[stackoverflow下这个文章](http://stackoverflow.com/questions/52187/virtual-serial-port-for-linux)发现用socat这个命令很好用，直接连两个伪终端就行，如： socat PTY,link=/tmp/ttyS0 PTY,link=/tmp/ttyS1 这样直接在minicom -D /tmp/ttyS0打开就能使用了，而且那俩是一个pair，很方便。